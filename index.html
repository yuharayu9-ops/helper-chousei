function logicMatching() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const hData = ss.getSheetByName('ヘルパー').getDataRange().getValues();
  const uData = ss.getSheetByName('利用者').getDataRange().getValues();
  const ruleData = ss.getSheetByName('配慮点').getDataRange().getValues(); // NGと優先の両方が入っている想定
  
  let matchSheet = ss.getSheetByName('マッチング結果') || ss.insertSheet('マッチング結果');
  matchSheet.clear();
  matchSheet.appendRow(["利用者名", "希望日時", "第一候補（優先）", "その他可能ヘルパー"]);

  uData.shift(); // ヘッダー削除
  uData.forEach(u => {
    let [date, uName, uStart, uEnd] = u;
    let priorityHelper = ""; // 優先ヘルパー
    let otherHelpers = [];   // その他の候補

    hData.forEach(h => {
      let [hName, hStart, hEnd] = [h[1], h[2], h[3]];
      
      // 1. NGチェック（配慮点シートに「不可」と書いてあれば除外）
      let isNG = ruleData.some(r => r[1] === hName && r[2].includes(uName) && r[2].includes("不可"));
      if (isNG) return; // 次のヘルパーへ

      // 2. 時間チェック
      if (hStart <= uStart && hEnd >= uEnd) {
        // 3. 優先チェック（配慮点シートに「優先」と書いてあるか）
        let isPriority = ruleData.some(r => r[1] === hName && r[2].includes(uName) && r[2].includes("優先"));
        
        if (isPriority) {
          priorityHelper = hName;
        } else {
          otherHelpers.push(hName);
        }
      }
    });

    matchSheet.appendRow([uName, uStart + "-" + uEnd, priorityHelper, otherHelpers.join(", ")]);
  });
}

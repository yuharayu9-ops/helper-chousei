// --- AI解析部分の修正版（エラー詳細表示付き） ---
try {
    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }, { inline_data: { mime_type: "image/jpeg", data: base64Data } }] }] })
    });

    const data = await res.json();
    
    // エラーが返ってきた場合にその内容をアラートで出す
    if (data.error) {
        alert("Google APIエラー: " + data.error.message);
        setIsAnalyzing(false);
        return;
    }

    const jsonStr = data.candidates[0].content.parts[0].text.match(/\[.*\]|\{.*\}/s)[0];
    // ...以下省略
